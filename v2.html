<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å»£å³¶äº”å¤©å››å¤œ (12/5-12/9)</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f9fafb;
            color: #333;
            -webkit-tap-highlight-color: transparent;
            padding-bottom: 90px; /* é ç•™åº•éƒ¨å°èˆªç©ºé–“ */
        }

        /* Scrollbar éš±è— */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* æ‰å¹³åŒ–å¡ç‰‡æ¨£å¼ */
        .flat-card {
            border: 1px solid #e5e7eb;
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
            transition: box-shadow 0.2s;
        }

        /* ç·¨è¼¯æç¤º (é•·æŒ‰æ•ˆæœ) */
        .editable-card:hover {
            box-shadow: 0 4px 10px rgba(37, 99, 235, 0.2);
        }
        .editable-card:active {
            box-shadow: 0 2px 5px rgba(37, 99, 235, 0.4);
            transform: scale(0.99);
        }
        .editable-card::after {
            content: 'é•·æŒ‰/å³éµç·¨è¼¯';
            position: absolute;
            top: 0;
            right: 0;
            background-color: #bfdbfe;
            color: #1e40af;
            padding: 2px 6px;
            border-bottom-left-radius: 8px;
            border-top-right-radius: 12px;
            font-size: 0.6rem;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .editable-card:hover::after {
            opacity: 1;
        }

        /* æ™‚é–“è»¸ç·šæ¢ */
        .timeline-line {
            position: absolute; left: 5px; top: 24px; bottom: -24px;
            width: 2px; background-color: #e5e7eb; z-index: 0;
        }
        .timeline-item:last-child .timeline-line { display: none; }

        /* Modal æ¨£å¼ (Slide-Up) */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.6); z-index: 1000;
            display: flex; align-items: flex-end; justify-content: center;
            padding: 0;
            opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        .modal.is-open { opacity: 1; pointer-events: auto; }

        .modal-content {
            background-color: #ffffff; width: 100%; max-width: 500px; max-height: 90vh;
            border-top-left-radius: 16px; border-top-right-radius: 16px;
            overflow-y: auto; padding: 24px;
            box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.15);
            position: relative;
            transform: translateY(100%); transition: transform 0.3s ease-out;
        }
        .modal.is-open .modal-content { transform: translateY(0); }
        .modal-content a { color: #2563eb; text-decoration: underline; }

        /* Logistical List Style */
        .logistics-list {
            white-space: pre-wrap; font-size: 0.875rem; color: #4b5563;
            line-height: 1.5; background-color: #f9fafb; padding: 10px;
            border-radius: 8px; margin-top: 8px; border: 1px solid #e5e7eb;
        }

        /* åº•éƒ¨å°èˆªæŒ‰éˆ•æ¨£å¼ */
        .nav-btn { color: #9ca3af; transition: all 0.2s; }
        .nav-btn.active { color: #2563eb; }
        .nav-btn.active .nav-icon { fill: currentColor; transform: scale(1.1); }

        /* Day æŒ‰éˆ•æ¨£å¼ */
        .day-tab-btn.active { background-color: #dbeafe; color: #1e40af; font-weight: 700; border: 1px solid #bfdbfe; }
        .day-tab-btn.inactive { background-color: #ffffff; color: #667280; border: 1px solid #f3f4f6; }
    </style>
</head>
<body>

    <!-- é ‚éƒ¨æ¨™é¡Œ -->
    <header class="relative w-full bg-white z-20 px-4 py-6 text-center mb-2 shadow-sm">
        <h1 class="text-2xl font-bold tracking-wide text-gray-800">å»£å³¶ä¹‹æ—…</h1>
        <p class="text-xs text-gray-400 mt-1">Hiroshima 5 Days Trip (12/5 - 12/9)</p>
    </header>

    <!-- å…§å®¹å®¹å™¨ -->
    <div class="max-w-md mx-auto relative min-h-screen">

        <!-- 1. è¡Œç¨‹é é¢ (Itinerary) -->
        <main id="view-itinerary" class="tab-view px-4">
            <!-- æ—¥æœŸåˆ‡æ› Tabs (Sticky: é»åœ¨é ‚éƒ¨) -->
            <div class="sticky top-0 z-40 bg-gray-50/95 backdrop-blur-sm pt-2 pb-4 -mx-4 px-4 border-b border-gray-200 shadow-sm">
                <div class="flex justify-between items-center gap-2" id="day-tabs-container">
                    <!-- ç”± JS ç”ŸæˆæŒ‰éˆ• -->
                </div>
            </div>

            <!-- è¡Œç¨‹å…§å®¹å€ -->
            <div id="day-content-container" class="mt-6">
                <!-- ç”± JS ç”Ÿæˆå…§å®¹ -->
            </div>
        </main>

        <!-- 2. è³‡è¨Šé é¢ (Info) -->
        <main id="view-info" class="tab-view hidden px-4 pt-6 space-y-6">
            
            <div class="flat-card p-5">
                <h3 class="font-bold text-gray-800 mb-4 flex items-center text-lg">
                    <span class="bg-blue-100 text-blue-600 px-2 py-1 rounded mr-2 text-xs font-bold">FLIGHT</span> èˆªç­è³‡è¨Š
                </h3>
                <div class="space-y-6">
                    <!-- å»ç¨‹ -->
                    <div class="flex justify-between items-center border-b border-gray-100 pb-4">
                        <div class="w-full">
                            <div class="flex justify-between items-end mb-1">
                                <span class="text-gray-400 text-xs font-medium bg-gray-100 px-2 py-0.5 rounded">å»ç¨‹ 12/5 (äº”)</span>
                                <span class="text-xs text-gray-400">è¯èˆª CI 112</span>
                            </div>
                            <div class="flex justify-between items-center mt-2">
                                <div class="text-center">
                                    <span class="block text-2xl font-bold text-gray-800">07:00</span>
                                    <span class="text-xs font-bold text-gray-500">TPE (æ¡ƒæ©Ÿ T2)</span>
                                </div>
                                <div class="flex-1 px-4 flex flex-col items-center">
                                    <span class="text-gray-300 text-xs mb-1">2h 15m</span>
                                    <div class="w-full h-px bg-gray-300 relative">
                                        <div class="absolute right-0 top-1/2 transform -translate-y-1/2 w-1 h-1 bg-gray-300 rounded-full"></div>
                                    </div>
                                </div>
                                <div class="text-center">
                                    <span class="block text-2xl font-bold text-gray-800">10:15</span>
                                    <span class="text-xs font-bold text-gray-500">HIJ (å»£å³¶)</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- å›ç¨‹ -->
                    <div class="flex justify-between items-center">
                        <div class="w-full">
                            <div class="flex justify-between items-end mb-1">
                                <span class="text-gray-400 text-xs font-medium bg-gray-100 px-2 py-0.5 rounded">å›ç¨‹ 12/9 (äºŒ)</span>
                                <span class="text-xs text-gray-400">è¯èˆª CI 113</span>
                            </div>
                            <div class="flex justify-between items-center mt-2">
                                <div class="text-center">
                                    <span class="block text-2xl font-bold text-gray-800">11:15</span>
                                    <span class="text-xs font-bold text-gray-500">HIJ (å»£å³¶)</span>
                                </div>
                                <div class="flex-1 px-4 flex flex-col items-center">
                                    <span class="text-gray-300 text-xs mb-1">2h 55m</span>
                                    <div class="w-full h-px bg-gray-300 relative">
                                        <div class="absolute right-0 top-1/2 transform -translate-y-1/2 w-1 h-1 bg-gray-300 rounded-full"></div>
                                    </div>
                                </div>
                                <div class="text-center">
                                    <span class="block text-2xl font-bold text-gray-800">13:10</span>
                                    <span class="text-xs font-bold text-gray-500">TPE (æ¡ƒæ©Ÿ T2)</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="flat-card p-5">
                <h3 class="font-bold text-gray-800 mb-4 flex items-center text-lg">
                    <span class="bg-indigo-100 text-indigo-600 px-2 py-1 rounded mr-2 text-xs font-bold">HOTEL</span> ä½å®¿è³‡è¨Š
                </h3>
                <div class="bg-gray-50 rounded-lg p-4 mb-4 border border-gray-100">
                    <p class="font-bold text-gray-800 text-lg">æ±æ©«INN å»£å³¶ç«™å‰å¤§æ©‹å—</p>
                    <p class="text-xs text-gray-500 mt-1 font-mono">Toyoko Inn Hiroshima Ekimae Ohashi Minami</p>
                    <div class="mt-3 flex gap-2">
                        <span class="text-xs bg-white border border-gray-200 px-2 py-1 rounded text-gray-500">Check-in 15:00</span>
                        <span class="text-xs bg-white border border-gray-200 px-2 py-1 rounded text-gray-500">å«æ—©é¤</span>
                    </div>
                    <div class="mt-2 text-xs text-gray-500">
                        Â¥74,795 (4æ™šç¸½è¨ˆ)
                    </div>
                </div>
                <a href="https://maps.app.goo.gl/t1k5Qv5FmQ2J7FwD8" target="_blank" class="flex items-center justify-center w-full bg-blue-600 text-white py-3 rounded-lg text-sm font-bold shadow-sm hover:bg-blue-700 transition">
                    <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path></svg>
                    é–‹å•Ÿ Google Map å°èˆª
                </a>
            </div>
        </main>

        <!-- 3. æº–å‚™é é¢ (Prep) -->
        <main id="view-prep" class="tab-view hidden px-4 pt-6 space-y-6">
            <div class="flat-card p-5 border-l-4 border-red-500 relative overflow-hidden">
                <div class="absolute right-0 top-0 opacity-10 transform translate-x-2 -translate-y-2">
                    <svg class="w-24 h-24 text-red-600" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg>
                </div>
                <h3 class="font-bold text-gray-800 mb-4 text-lg">ç·Šæ€¥è¯çµ¡</h3>
                <div class="grid grid-cols-2 gap-3 text-sm relative z-10">
                    <div class="bg-gray-50 p-3 rounded-lg border border-gray-100">
                        <span class="block text-gray-400 text-xs mb-1">è­¦å¯Ÿ (Police)</span>
                        <a href="tel:110" class="font-mono font-bold text-xl text-gray-800">110</a>
                    </div>
                    <div class="bg-gray-50 p-3 rounded-lg border border-gray-100">
                        <span class="block text-gray-400 text-xs mb-1">æ•‘è­·/ç«è­¦ (Fire)</span>
                        <a href="tel:119" class="font-mono font-bold text-xl text-gray-800">119</a>
                    </div>
                    <div class="bg-red-50 p-3 rounded-lg border border-red-100 col-span-2">
                        <span class="block text-red-400 text-xs mb-1">é§å¤§é˜ªè¾¦äº‹è™• (ç·Šæ€¥)</span>
                        <a href="tel:+819087944568" class="font-mono font-bold text-xl text-red-600">090-8794-4568</a>
                    </div>
                </div>
            </div>

            <div class="flat-card p-5">
                <h3 class="font-bold text-gray-800 mb-4 text-lg">è¡Œææ¸…å–® Check</h3>
                <ul class="space-y-3">
                    <li class="flex items-center group cursor-pointer">
                        <input type="checkbox" id="c1" class="peer w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 cursor-pointer">
                        <label for="c1" class="ml-3 text-sm text-gray-600 peer-checked:text-gray-400 peer-checked:line-through cursor-pointer select-none">è­·ç…§ (æœ‰æ•ˆæœŸé™å…§)</label>
                    </li>
                    <li class="flex items-center group cursor-pointer">
                        <input type="checkbox" id="c2" class="peer w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 cursor-pointer">
                        <label for="c2" class="ml-3 text-sm text-gray-600 peer-checked:text-gray-400 peer-checked:line-through cursor-pointer select-none">Visit Japan Web QR Code</label>
                    </li>
                    <li class="flex items-center group cursor-pointer">
                        <input type="checkbox" id="c3" class="peer w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 cursor-pointer">
                        <label for="c3" class="ml-3 text-sm text-gray-600 peer-checked:text-gray-400 peer-checked:line-through cursor-pointer select-none">æ—¥å¹£ç¾é‡‘ / ä¿¡ç”¨å¡ / äº¤é€šå¡</label>
                    </li>
                    <li class="flex items-center group cursor-pointer">
                        <input type="checkbox" id="c4" class="peer w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 cursor-pointer">
                        <label for="c4" class="ml-3 text-sm text-gray-600 peer-checked:text-gray-400 peer-checked:line-through cursor-pointer select-none">ç¶²å¡ / Wi-Fi æ©Ÿ</label>
                    </li>
                     <li class="flex items-center group cursor-pointer">
                        <input type="checkbox" id="c5" class="peer w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 cursor-pointer">
                        <label for="c5" class="ml-3 text-sm text-gray-600 peer-checked:text-gray-400 peer-checked:line-through cursor-pointer select-none">è½‰æ¥é ­ (æ—¥æœ¬é›™å­”æ‰æ’)</label>
                    </li>
                </ul>
                <button onclick="localStorage.removeItem('user_itinerary_hiroshima'); location.reload();" class="mt-4 text-xs text-red-500 hover:text-red-700 transition">
                    æ¸…é™¤æ‰€æœ‰æœ¬åœ°ç·¨è¼¯è¨˜éŒ„
                </button>
            </div>
        </main>

        <!-- 4. æŒ‡å—é é¢ (Guide) -->
        <main id="view-guide" class="tab-view hidden px-4 pt-6 space-y-6">
            <div class="flat-card overflow-hidden">
                <div class="bg-gradient-to-r from-orange-50 to-white p-4 border-b border-orange-100">
                    <h3 class="font-bold text-orange-800 text-lg">äº¤é€šç¥¨åˆ¸</h3>
                </div>
                <div class="p-5 text-sm space-y-4">
                    <div class="flex items-start">
                        <span class="flex-shrink-0 bg-orange-100 text-orange-600 rounded-lg w-8 h-8 flex items-center justify-center font-bold text-sm mr-3">1</span>
                        <div><strong class="text-gray-800 text-base block mb-1">å»£å³¶è§€å…‰å‘¨éŠåˆ¸ (Visit Hiroshima Tourist Pass)</strong>
                            <span class="text-gray-500 leading-relaxed">
                                1æ—¥åˆ¸: å¤§äºº1,000æ—¥åœ“<br>
                                2æ—¥åˆ¸: å¤§äºº1,500æ—¥åœ“<br>
                                3æ—¥åˆ¸: å¤§äºº2,000æ—¥åœ“
                            </span>
                        </div>
                    </div>
                     <div class="flex items-start">
                        <span class="flex-shrink-0 bg-orange-100 text-orange-600 rounded-lg w-8 h-8 flex items-center justify-center font-bold text-sm mr-3">2</span>
                        <div><strong class="text-gray-800 text-base block mb-1">è§€å…‰å¾ªç’°å·´å£« (Maple-oop)</strong>
                            <span class="text-gray-500 leading-relaxed">
                                å–®ç¨‹: 240æ—¥åœ“<br>
                                1æ—¥åˆ¸: 600æ—¥åœ“
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="flat-card overflow-hidden">
                <div class="bg-gradient-to-r from-blue-50 to-white p-4 border-b border-blue-100">
                    <h3 class="font-bold text-blue-800 text-lg">12æœˆè¡£è‘—å»ºè­°</h3>
                </div>
                <div class="p-5 text-sm text-gray-600">
                    <div class="flex items-center mb-3">
                        <span class="text-2xl mr-2">â„ï¸</span>
                        <span class="font-medium">å¹³å‡æ°£æº« 5Â°C ~ 12Â°C</span>
                    </div>
                    <ul class="list-disc pl-5 mt-2 space-y-2 leading-relaxed">
                        <li><strong>æ´‹è”¥å¼ç©¿æ­ï¼š</strong>å®¤å…§/é›»è»Šæš–æ°£å¼·ï¼Œå»ºè­°å…§ç©¿ç™¼ç†±è¡£ï¼Œå¤–æ­é˜²é¢¨å¤§è¡£ã€‚</li>
                        <li><strong>é˜²é¢¨é…ä»¶ï¼š</strong>å®®å³¶ã€å°¾é“æµ·é‚Šé¢¨å¤§ï¼Œå‹™å¿…æ”œå¸¶åœå·¾ã€æ¯›å¸½ã€‚</li>
                        <li><strong>å¥½èµ°çš„é‹ï¼š</strong>å°¾é“ã€å®®å³¶éœ€çˆ¬å¡ï¼Œè«‹ç©¿èˆ’é©çƒé‹ã€‚</li>
                    </ul>
                </div>
            </div>
        </main>
    </div>

    <!-- åº•éƒ¨å°èˆªåˆ— -->
    <nav class="fixed bottom-0 w-full bg-white border-t border-gray-200 flex justify-around items-center pb-safe-area-bottom z-30 h-20 shadow-[0_-2px_10px_rgba(0,0,0,0.05)]">
        <button class="nav-btn active flex flex-col items-center justify-center w-full h-full" onclick="switchMainTab('itinerary')">
            <svg class="w-6 h-6 mb-1 nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg>
            <span class="text-[10px] font-bold">è¡Œç¨‹</span>
        </button>
        <button class="nav-btn flex flex-col items-center justify-center w-full h-full" onclick="switchMainTab('info')">
            <svg class="w-6 h-6 mb-1 nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            <span class="text-[10px] font-bold">è³‡è¨Š</span>
        </button>
        <button class="nav-btn flex flex-col items-center justify-center w-full h-full" onclick="switchMainTab('prep')">
            <svg class="w-6 h-6 mb-1 nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            <span class="text-[10px] font-bold">æº–å‚™</span>
        </button>
        <button class="nav-btn flex flex-col items-center justify-center w-full h-full" onclick="switchMainTab('guide')">
            <svg class="w-6 h-6 mb-1 nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg>
            <span class="text-[10px] font-bold">æŒ‡å—</span>
        </button>
    </nav>

    <!-- æ™¯é»ä»‹ç´¹ Modal è¦–çª— -->
    <div id="details-modal" class="modal hidden" onclick="closeModal('details-modal')">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h3 id="modal-title" class="text-xl font-bold text-gray-800 mb-4 border-b pb-2"></h3>
            <div id="modal-body" class="text-sm text-gray-700 leading-relaxed space-y-4"></div>
            <button onclick="closeModal('details-modal')" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 p-2 rounded-full bg-gray-50 transition">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
        </div>
    </div>

    <!-- ç·¨è¼¯ Modal è¦–çª— -->
    <div id="edit-modal" class="modal hidden" onclick="closeModal('edit-modal')">
        <form class="modal-content" onclick="event.stopPropagation()" onsubmit="saveEdit(event)">
            <h3 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">ç·¨è¼¯è¡Œç¨‹é …ç›®</h3>
            <input type="hidden" id="edit-day-index">
            <input type="hidden" id="edit-event-index">
            <input type="hidden" id="edit-item-index">
            
            <div class="mb-4">
                <label for="edit-time" class="block text-xs font-bold text-gray-500 mb-1">æ™‚é–“ (Time)</label>
                <input type="text" id="edit-time" class="w-full border border-gray-300 rounded-lg p-3 text-sm focus:ring-blue-500 focus:border-blue-500" placeholder="ä¾‹å¦‚: 10:00">
            </div>

            <div class="mb-4">
                <label for="edit-title" class="block text-xs font-bold text-gray-500 mb-1">æ¨™é¡Œ (Title)</label>
                <input type="text" id="edit-title" required class="w-full border border-gray-300 rounded-lg p-3 text-sm font-semibold focus:ring-blue-500 focus:border-blue-500" placeholder="æ™¯é»æˆ–æ´»å‹•åç¨±">
            </div>

            <div class="mb-6">
                <label for="edit-desc" class="block text-xs font-bold text-gray-500 mb-1">è©³ç´°èªªæ˜ / å‚™è¨»</label>
                <textarea id="edit-desc" rows="6" class="w-full border border-gray-300 rounded-lg p-3 text-sm focus:ring-blue-500 focus:border-blue-500" placeholder="äº¤é€šã€å‚™è¨»ã€ç´°ç¯€ã€åœ°åœ–é€£çµç­‰ (å¯å¤šè¡Œ)"></textarea>
            </div>

            <div class="flex justify-end space-x-3">
                <button type="button" onclick="closeModal('edit-modal')" class="bg-gray-200 text-gray-700 font-bold py-3 px-6 rounded-lg hover:bg-gray-300 transition">å–æ¶ˆ</button>
                <button type="submit" class="bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition shadow-lg shadow-blue-500/50">å„²å­˜ä¿®æ”¹</button>
            </div>
             <button type="button" onclick="closeModal('edit-modal')" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 p-2 rounded-full bg-gray-50 transition">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
        </form>
    </div>

    <script>
        // --- æ ¸å¿ƒè³‡æ–™èˆ‡ LocalStorage è™•ç† ---

        // åŸå§‹è¡Œç¨‹è³‡æ–™ (æ ¹æ“š PDF å…§å®¹å¡«å…¥)
        const originalItineraryData = [
            {
                day: 1, dayLabel: 'D1', date: '12/5 (äº”)', location: 'å°åŒ— âœˆï¸ å»£å³¶å¸‚å€',
                events: [
                    { time: '02:30', title: 'äº¤é€š: æ©Ÿå ´æ¥é€', type: 'transport', desc: 'æ±æ­¢ â†’ æ¡ƒåœ’æ©Ÿå ´ (1h10m)', uniqueId: 'd1e1' },
                    { time: '03:50', title: 'æ¡ƒåœ’æ©Ÿå ´ ç¬¬2èˆªå»ˆ', type: 'misc', desc: 'Check-in / å‡ºå¢ƒæ‰‹çºŒ', uniqueId: 'd1e2' },
                    { time: '07:00', end: '10:15', title: 'èˆªç­ CI112', type: 'transport', desc: 'TPE â†’ HIJ (2h15m)', uniqueId: 'd1e3' },
                    {
                        time: '10:40',
                        title: 'æ©Ÿå ´å·´å£« â†’ å»£å³¶ç«™',
                        type: 'transport',
                        desc: 'ğŸšŒ ä¹˜è»Šåœ°é»ï¼šå»£å³¶æ©Ÿå ´å·´å£«ã€2è™Ÿæœˆå°ã€‘\nğŸ’° è»Šè³‡ï¼šÂ¥1500\nâ³ è·¯ç¨‹ï¼š50åˆ† (ç´„15åˆ†ä¸€ç­)\nğŸ’¡ å‚™è¨»ï¼šå‰é–€ä¸Šè»Š',
                        uniqueId: 'd1e5'
                    },
                    {
                        time: '11:30',
                        title: 'æŠµé”å»£å³¶è»Šç«™',
                        type: 'misc',
                        desc: 'ğŸ“ è³¼è²·ç¥¨åˆ¸ï¼š\n1. å»£å³¶è§€å…‰å‘¨éŠåˆ¸ (1æ—¥Â¥1000/2æ—¥Â¥1500)\n2. è§€å…‰å¾ªç’°å·´å£«1æ—¥åˆ¸ (Â¥600)',
                        uniqueId: 'd1e6'
                    },
                    {
                        time: '11:45',
                        title: 'åˆé¤ï¼šå»£å³¶è»Šç«™ (minamoa/ekie)',
                        type: 'meal',
                        desc: '1F å°¾é“æ‹‰éºµ (10:00-22:00)\n2F SOUP CURRY KING æ¹¯å’–å“©\n6F å™å™è‹‘(ç‡’è‚‰) / ç‚­ç‡’ç‰›èˆŒ æ±å±±',
                        uniqueId: 'd1e7'
                    },
                    { time: '14:15', title: 'äº¤é€šï¼šæ­¥è¡Œå¾€é£¯åº—', type: 'transport', desc: 'ç´„7åˆ†é˜', uniqueId: 'd1e9' },
                    { time: '15:00', title: 'Check-in', type: 'hotel', desc: 'æ±æ©«INN å»£å³¶ç«™å‰å¤§æ©‹å—', uniqueId: 'd1e10' },
                    {
                        time: '15:30',
                        title: 'äº¤é€šï¼šå‰å¾€å’Œå¹³å…¬åœ’',
                        type: 'transport',
                        desc: 'ğŸ’° è»Šè³‡ï¼šÂ¥240\nğŸšŒ å…¬è»Š24 (6è™Ÿæœˆå°) / å…¬è»Š25 (ç¨»è·ç”º) / å»£é›» (ç¨»è·ç”º)',
                        uniqueId: 'd1e11'
                    },
                    {
                        time: '16:00',
                        title: 'å’Œå¹³ç´€å¿µå…¬åœ’å‘¨é‚Š',
                        type: 'spot',
                        uniqueId: 'd1e12',
                        items: [
                            {
                                name: 'å»£å³¶å’Œå¹³ç´€å¿µè³‡æ–™é¤¨',
                                mapQuery: 'å»£å³¶å’Œå¹³ç´€å¿µè³‡æ–™é¤¨',
                                logistics: 'ğŸ’° é–€ç¥¨ï¼šÂ¥200\nğŸ•™ ç‡Ÿæ¥­æ™‚é–“ï¼š7:30 - 18:00\nâš ï¸ 16:30åœæ­¢å”®ç¥¨',
                                details: 'å±•ç¤ºåŸçˆ†çš„æ…˜ç—›æ­·å²èˆ‡éºç‰©ï¼Œç¥ˆæ±‚ä¸–ç•Œå’Œå¹³ã€‚',
                                uniqueId: 'd1e12i1'
                            },
                            {
                                name: 'åŸçˆ†åœ“é ‚é¤¨',
                                mapQuery: 'åŸçˆ†åœ“é ‚é¤¨',
                                logistics: 'ä¸–ç•Œæ–‡åŒ–éºç”¢\nğŸ•™ é»ç‡ˆæ™‚é–“ï¼š20:00 - 0:00\nğŸ“± åŸçˆ†é¤¨ARé«”é©—',
                                details: 'å°‘æ•¸åœ¨åŸçˆ†ä¸­å¿ƒé™„è¿‘æ²’æœ‰å®Œå…¨å€’å¡Œçš„å»ºç¯‰ï¼Œä¿ç•™äº†ç•¶æ™‚çš„æ®˜ç ´åŸè²Œã€‚',
                                uniqueId: 'd1e12i2'
                            }
                        ]
                    },
                    {
                        time: '18:30',
                        title: 'æ™šé¤ï¼šæ¾å±‹ / æœ¬é€šå•†åº—è¡—',
                        type: 'meal',
                        desc: 'ğŸ›ï¸ é€›è¡—ï¼š\nLOFT, Seria (è‡³19:30)\nUNIQLO, å¤§å‰µ (è‡³20:00)\nPARCO (è‡³20:30)\nå”å‰è»»å¾· (è‡³05:00)',
                        uniqueId: 'd1e13'
                    },
                    {
                        time: '20:30',
                        title: 'äº¤é€šï¼šè¿”å›é£¯åº—',
                        type: 'transport',
                        desc: 'ğŸ’° è»Šè³‡ï¼šÂ¥240\nç”±å…«ä¸å €æ­ä¹˜å»£é›»æˆ–å…¬è»Šè¿”å›å»£å³¶ç«™/ç¨»è·ç”º',
                        uniqueId: 'd1e15'
                    }
                ]
            },
            {
                day: 2, dayLabel: 'D2', date: '12/6 (å…­)', location: 'å»£å³¶ ğŸš„ å³å¸‚',
                events: [
                    {
                        time: '08:30',
                        title: 'äº¤é€šï¼šå‰å¾€å»£å³¶åŸ',
                        type: 'transport',
                        desc: 'ğŸ’° è»Šè³‡ï¼šÂ¥240\nå…¬è»Šï¼šå»£å³¶ç«™ â†’ åˆåŒå»³èˆå‰ (å†æ­¥è¡Œ5åˆ†)',
                        uniqueId: 'd2e0'
                    },
                    {
                        time: '09:00',
                        title: 'å»£å³¶åŸ & è­·åœ‹ç¥ç¤¾',
                        type: 'spot',
                        uniqueId: 'd2e1',
                        items: [
                            {
                                name: 'å»£å³¶åŸ (å¤©å®ˆé–£)',
                                mapQuery: 'å»£å³¶åŸ',
                                logistics: 'ğŸ’° é–€ç¥¨ï¼šÂ¥370\nğŸ•™ ç‡Ÿæ¥­æ™‚é–“ï¼š9:00-17:00 (16:30æœ€å¾Œå…¥å ´)',
                                details: 'åˆ¥åé¯‰åŸã€‚åƒè§€å¤©å®ˆé–£éœ€è³¼ç¥¨ï¼ŒäºŒä¹‹ä¸¸å…è²»ã€‚',
                                uniqueId: 'd2e1i1'
                            },
                            {
                                name: 'å»£å³¶è­·åœ‹ç¥ç¤¾',
                                mapQuery: 'å»£å³¶è­·åœ‹ç¥ç¤¾',
                                logistics: 'ğŸ•™ 9:00 - 16:30',
                                details: 'ä½æ–¼å»£å³¶åŸå…§ã€‚',
                                uniqueId: 'd2e1i2'
                            }
                        ]
                    },
                    {
                        time: '10:45',
                        title: 'äº¤é€šï¼šè¿”å›å»£å³¶ç«™',
                        type: 'transport',
                        desc: 'æ­¥è¡Œæˆ–æ­ä¹˜è§€å…‰å·´å£«/å…¬è»Š',
                        uniqueId: 'd2e2'
                    },
                    { time: '11:45', title: 'åˆé¤ï¼šå»£å³¶è»Šç«™ 6F', type: 'meal', desc: 'ç‚­ç„¼ç‰›ãŸã‚“æ±å±± é›… (ä»™å°ç‰›èˆŒ)', uniqueId: 'd2e3' },
                    {
                        time: '13:00',
                        title: 'äº¤é€šï¼šJRå±±é™½æœ¬ç·š â†’ å³å¸‚',
                        type: 'transport',
                        desc: 'ğŸ’° è»Šè³‡ï¼šÂ¥510\nâ³ è»Šç¨‹ï¼šç´„33-40åˆ†\n(å»£å³¶ç«™ â†’ å³ç«™)',
                        uniqueId: 'd2e4'
                    },
                    {
                        time: '13:33',
                        title: 'æŠµé”å³å¸‚ / è³¼è²·ä¸€æ—¥åˆ¸',
                        type: 'misc',
                        desc: 'ğŸ“ å³å¸‚è§€å…‰è«®è©¢ä¸­å¿ƒ (å³ç«™2æ¨“)\nâš ï¸ å»ºè­°å…ˆå»å ±åã€Œå³ç£èˆ¹è‰¦å·¡ç¦®ã€å¤•é™½èˆ¹ç­',
                        uniqueId: 'd2e5'
                    },
                    {
                        time: '14:00',
                        title: 'å³å¸‚åšç‰©é¤¨ç¾¤',
                        type: 'spot',
                        uniqueId: 'd2e6',
                        items: [
                            {
                                name: 'å¤§å’Œåšç‰©é¤¨',
                                mapQuery: 'å¤§å’Œåšç‰©é¤¨',
                                logistics: 'ğŸ’° é–€ç¥¨ï¼šÂ¥500\nğŸ•™ 9:00-18:00 (é€±äºŒä¼‘)',
                                details: 'å±•ç¤º1/10æ¯”ä¾‹çš„å¤§å’Œè™Ÿæˆ°è‰¦æ¨¡å‹ï¼Œä»‹ç´¹å³å¸‚æµ·è»æ­·å²ã€‚',
                                uniqueId: 'd2e6i1'
                            },
                            {
                                name: 'æµ·ä¸Šè‡ªè¡›éšŠå³å²æ–™é¤¨ (éµé¯¨é¤¨)',
                                mapQuery: 'æµ·ä¸Šè‡ªè¡›éšŠå³å²æ–™é¤¨',
                                logistics: 'ğŸ’° å…è²»\nğŸ•™ 10:00-18:00 (é€±äºŒä¼‘)',
                                details: 'å¯é€²å…¥çœŸå¯¦çš„é€€å½¹æ½›æ°´è‰‡åƒè§€ã€‚',
                                uniqueId: 'd2e6i2'
                            }
                        ]
                    },
                    {
                        time: '16:00',
                        title: 'å³ç£èˆ¹è‰¦å·¡ç¦® (å¤•é™½èˆ¹ç­)',
                        type: 'spot',
                        uniqueId: 'd2e7',
                        items: [{
                            name: 'èˆ¹è‰¦å·¡ç¦®',
                            mapQuery: 'å³ä¸­å¤®ç¢¼é ­',
                            logistics: 'ğŸ’° èˆ¹ç¥¨ï¼šÂ¥1700\nâš ï¸ å‡ºç™¼å‰15åˆ†éœ€æŠµé”ç¢¼é ­',
                            details: 'èˆªè¡Œæ™‚é–“ç´„35åˆ†é˜ï¼Œå¯è¿‘è·é›¢è§€çœ‹æ½›æ°´è‰‡èˆ‡è»è‰¦ã€‚',
                            uniqueId: 'd2e7i1'
                        }]
                    },
                    {
                        time: '18:00',
                        title: 'æ™šé¤ / è³¼ç‰©',
                        type: 'meal',
                        desc: 'ğŸ“ Youme Town å³åº—\n3F å®šé£Ÿå±‹ç™¾èœæ—¬ / 1-2F Uniqlo, Seria',
                        uniqueId: 'd2e8'
                    },
                    {
                        time: '20:00',
                        title: 'äº¤é€šï¼šJRå³ç·š â†’ å»£å³¶',
                        type: 'transport',
                        desc: 'ğŸ’° è»Šè³‡ï¼šÂ¥510\nç­æ¬¡ï¼š20:07, 20:32, 21:22',
                        uniqueId: 'd2e9'
                    }
                ]
            },
            {
                day: 3, dayLabel: 'D3', date: '12/7 (æ—¥)', location: 'å°¾é“ ğŸš„ ä¸‰åŸ',
                events: [
                    {
                        time: '08:48',
                        title: 'äº¤é€šï¼šJRå±±é™½æœ¬ç·š â†’ å°¾é“',
                        type: 'transport',
                        desc: 'ğŸ’° è»Šè³‡ï¼šÂ¥1,520\nå»£å³¶ â†’ (ç³¸å´/ä¸‰åŸæ›è»Š) â†’ å°¾é“\nâ³ ç¸½è»Šç¨‹ç´„1.5 - 2å°æ™‚',
                        uniqueId: 'd3e1'
                    },
                    { time: '10:45', title: 'æŠµé”å°¾é“ / å•†åº—è¡—', type: 'misc', desc: 'é€›å°¾é“æœ¬é€šå•†åº—è¡—', uniqueId: 'd3e2' },
                    {
                        time: '11:30',
                        title: 'åˆé¤ï¼šå°¾é“æ‹‰éºµ / å¸ƒä¸',
                        type: 'meal',
                        desc: 'ğŸœ æ‹‰éºµï¼šMaruboshi, å°¾é“æ‹‰éºµãƒ™ãƒƒãƒãƒ£ãƒ¼\nğŸ® ç”œé»ï¼šå°é‡è²“é»å¿ƒé‹ªå¸ƒä¸',
                        uniqueId: 'd3e3'
                    },
                    {
                        time: '13:00',
                        title: 'åƒå…‰å¯ºå±±çºœè»Š',
                        type: 'transport',
                        desc: 'ğŸ’° å–®ç¨‹ Â¥500 / ä¾†å› Â¥700\nğŸ’¡ å»ºè­°æ­çºœè»Šä¸Šå±±ï¼Œèµ°è·¯ä¸‹å±±',
                        uniqueId: 'd3e4'
                    },
                    {
                        time: '13:30',
                        title: 'å°¾é“æ•£ç­–',
                        type: 'spot',
                        uniqueId: 'd3e5',
                        items: [
                            {
                                name: 'åƒå…‰å¯º & å…¬åœ’',
                                mapQuery: 'åƒå…‰å¯º',
                                logistics: 'ğŸ•™ 9:00 - 17:00',
                                details: 'ä¿¯ç°ç€¨æˆ¶å…§æµ·èˆ‡å°¾é“æ°´é“çš„çµ•æ™¯ã€‚',
                                uniqueId: 'd3e5i1'
                            },
                            {
                                name: 'å°¾é“å¸‚ç«‹ç¾è¡“é¤¨',
                                mapQuery: 'å°¾é“å¸‚ç«‹ç¾è¡“é¤¨',
                                logistics: 'ğŸ’° Â¥310\nå®‰è—¤å¿ é›„æ”¹å»º',
                                details: 'è‘—åçš„è²“èˆ‡è­¦è¡›ç¾è¡“é¤¨ã€‚',
                                uniqueId: 'd3e5i2'
                            },
                            {
                                name: 'è²“ä¹‹ç´°é“',
                                mapQuery: 'è²“ä¹‹ç´°é“',
                                logistics: 'æ­¥è¡Œä¸‹å±±',
                                details: 'å°‹æ‰¾ç¦çŸ³è²“ï¼Œå……æ»¿æ‡·èˆŠæ°›åœçš„å¡é“ã€‚',
                                uniqueId: 'd3e5i3'
                            }
                        ]
                    },
                    {
                        time: '16:30',
                        title: 'æ­¥è¡Œè‡³è»Šç«™',
                        type: 'transport',
                        desc: 'ç´„15åˆ†é˜',
                        uniqueId: 'd3e6'
                    },
                    {
                        time: '17:03',
                        title: 'äº¤é€šï¼šJR å°¾é“ â†’ ä¸‰åŸ',
                        type: 'transport',
                        desc: 'ğŸ’° è»Šè³‡ï¼šÂ¥240\nâ³ è»Šç¨‹ç´„15åˆ†',
                        uniqueId: 'd3e7'
                    },
                    {
                        time: '17:20',
                        title: 'ä¸‰åŸåŸè·¡ (æµ®åŸ)',
                        type: 'spot',
                        uniqueId: 'd3e8',
                        items: [{
                            name: 'ä¸‰åŸåŸè·¡',
                            mapQuery: 'ä¸‰åŸåŸè·¡',
                            logistics: 'å¤©å®ˆå°èˆ‡è»Šç«™å…±æ§‹',
                            details: 'æ›¾ç¶“æ˜¯æµ®åœ¨æµ·ä¸Šçš„æ°´è»åŸã€‚',
                            uniqueId: 'd3e8i1'
                        }]
                    },
                    {
                        time: '17:45',
                        title: 'æ™šé¤ï¼šç« é­šæ–™ç†',
                        type: 'meal',
                        desc: 'ğŸ™ æ¨è–¦ï¼šKodama (å·¨ç„¡éœ¸ç« é­šå¤©å©¦ç¾…) æˆ– å’Œé£Ÿå‡¦ ç™»å–œå°†',
                        uniqueId: 'd3e9'
                    },
                    {
                        time: '19:13',
                        title: 'äº¤é€šï¼šJRä¸‰åŸ â†’ å»£å³¶',
                        type: 'transport',
                        desc: 'ğŸ’° è»Šè³‡ï¼šÂ¥1,340 (æ…¢è»Š) / Â¥2,330 (æ–°å¹¹ç·šè‡ªç”±å¸­)\nâ³ æ…¢è»Šç´„74åˆ† / æ–°å¹¹ç·š26åˆ†',
                        uniqueId: 'd3e10'
                    }
                ]
            },
            {
                day: 4, dayLabel: 'D4', date: '12/8 (ä¸€)', location: 'å®®å³¶ä¸€æ—¥éŠ',
                events: [
                    {
                        time: '08:10',
                        title: 'äº¤é€šï¼šJRå»£å³¶ â†’ å®®å³¶å£',
                        type: 'transport',
                        desc: 'ğŸ’° è»Šè³‡ï¼šÂ¥420\nâ³ è»Šç¨‹ï¼šç´„30åˆ†',
                        uniqueId: 'd4e1'
                    },
                    {
                        time: '09:10',
                        title: 'äº¤é€šï¼šJRæ¸¡è¼ª â†’ å®®å³¶',
                        type: 'transport',
                        desc: 'ğŸ’° å–®ç¨‹ Â¥200 + è¨ªå•ç¨… Â¥100\nğŸ’¡ 9:10~16:10 çš„JRæ¸¡è¼ªæœƒç¹è¡Œé è¿‘å¤§é³¥å±…',
                        uniqueId: 'd4e2'
                    },
                    { time: '09:20', title: 'æŠµé”å®®å³¶', type: 'misc', desc: 'æ­¥è¡Œ20åˆ†è‡³ç´…è‘‰è°·å…¬åœ’', uniqueId: 'd4e3' },
                    {
                        time: '10:30',
                        title: 'å®®å³¶çºœè»Š & å½Œå±±',
                        type: 'spot',
                        uniqueId: 'd4e4',
                        items: [
                            {
                                name: 'å®®å³¶çºœè»Š',
                                mapQuery: 'å®®å³¶çºœè»Šç´…è‘‰è°·ç«™',
                                logistics: 'ğŸ’° ä¾†å› Â¥2000\nğŸ•™ 9:00-16:00',
                                details: 'åˆ†å…©æ®µæ­ä¹˜ (ç´…è‘‰è°·ç·š + ç…å­å²©ç·š)ã€‚',
                                uniqueId: 'd4e4i1'
                            },
                            {
                                name: 'å½Œå±± (ç…å­å²©/éˆç«å ‚)',
                                mapQuery: 'å½Œå±±å±•æœ›å°',
                                logistics: 'ä¸–ç•Œè‡ªç„¶éºç”¢',
                                details: 'å¾ç…å­å²©ç«™å¾€è¿”éˆç«å ‚ç´„30åˆ†-1å°æ™‚ã€‚',
                                uniqueId: 'd4e4i2'
                            }
                        ]
                    },
                    {
                        time: '12:30',
                        title: 'åˆé¤ï¼šè¡¨åƒé“å•†åº—è¡—',
                        type: 'meal',
                        desc: 'ğŸ¦ª ç‰¡è £å±‹ / ç„¼ããŒãã®ã¯ã‚„ã— (çƒ¤ç‰¡è £)\nğŸ± å²©ã‚€ã‚‰ (æ˜Ÿé°»é£¯)\nğŸ ç´…è‘‰å ‚ (ç‚¸ç´…è‘‰é¥…é ­)',
                        uniqueId: 'd4e5'
                    },
                    {
                        time: '14:00',
                        title: 'åƒç–Šé–£ & äº”é‡å¡”',
                        type: 'spot',
                        uniqueId: 'd4e6',
                        items: [{
                            name: 'åƒç–Šé–£',
                            mapQuery: 'åƒç–Šé–£',
                            logistics: 'ğŸ’° é–€ç¥¨ï¼šÂ¥100',
                            details: 'è±è‡£ç§€å‰æœªå®Œæˆçš„å»ºç¯‰ï¼Œæ°£å‹¢æ¢å®ã€‚',
                            uniqueId: 'd4e6i1'
                        }]
                    },
                    {
                        time: '14:30',
                        title: 'åš´å³¶ç¥ç¤¾ & å¤§è–é™¢',
                        type: 'spot',
                        uniqueId: 'd4e7',
                        items: [
                            {
                                name: 'åš´å³¶ç¥ç¤¾',
                                mapQuery: 'åš´å³¶ç¥ç¤¾',
                                logistics: 'ğŸ’° é–€ç¥¨ï¼šÂ¥300\nğŸ•™ 6:30 - 17:00',
                                details: 'ä¸–ç•Œæ–‡åŒ–éºç”¢ï¼Œæµ·ä¸Šç¥ç¤¾ã€‚',
                                uniqueId: 'd4e7i1'
                            },
                            {
                                name: 'å¤§è–é™¢',
                                mapQuery: 'å¤§è–é™¢',
                                logistics: 'ğŸ’° å…è²»',
                                details: 'å®®å³¶æ­·å²æœ€æ‚ ä¹…çš„å¯ºå»Ÿã€‚',
                                uniqueId: 'd4e7i2'
                            }
                        ]
                    },
                    {
                        time: '18:25',
                        title: 'äº¤é€šï¼šæ¸¡è¼ª & JR è¿”å›å»£å³¶',
                        type: 'transport',
                        desc: 'ğŸš¢ æ¸¡è¼ªï¼š18:25, 18:40, 18:55\nğŸšƒ JRå®®å³¶å£ â†’ å»£å³¶ (Â¥420)',
                        uniqueId: 'd4e8'
                    }
                ]
            },
            {
                day: 5, dayLabel: 'D5', date: '12/9 (äºŒ)', location: 'å»£å³¶ âœˆï¸ å°åŒ—',
                events: [
                    { time: '06:30', title: 'Check-out', type: 'hotel', desc: 'å‰å¾€å»£å³¶ç«™æ–°å¹¹ç·šå£', uniqueId: 'd5e1' },
                    {
                        time: '07:00',
                        title: 'äº¤é€šï¼šæ©Ÿå ´å·´å£« â†’ æ©Ÿå ´',
                        type: 'transport',
                        desc: 'ğŸ’° Â¥1500\nğŸ“ å»£å³¶ç«™åŒ—å£5è™Ÿæœˆå°\nâ³ è»Šç¨‹ç´„50åˆ†',
                        uniqueId: 'd5e2'
                    },
                    { time: '07:50', title: 'æŠµé”å»£å³¶æ©Ÿå ´', type: 'misc', desc: 'è¾¦ç†ç™»æ©Ÿ', uniqueId: 'd5e3' },
                    {
                        time: '11:15',
                        title: 'èˆªç­ CI113',
                        type: 'transport',
                        desc: 'HIJ â†’ TPE (æ¡ƒåœ’æ©Ÿå ´ T2)\né è¨ˆ 13:10 æŠµé”',
                        uniqueId: 'd5e4'
                    }
                ]
            }
        ];

        // è®Šæ•¸ç”¨æ–¼å„²å­˜ç•¶å‰ä½¿ç”¨çš„è¡Œç¨‹è³‡æ–™
        let currentItineraryData = [];
        // è®Šæ•¸ç”¨æ–¼å„²å­˜ç•¶å‰é¡¯ç¤ºçš„ Day Index
        let currentDayIndex = 0;

        // --- åˆå§‹åŒ–èˆ‡è³‡æ–™è¼‰å…¥ (é›¢ç·š LocalStorage) ---
        function loadItineraryData() {
            try {
                const storedData = localStorage.getItem('user_itinerary_hiroshima');
                if (storedData) {
                    currentItineraryData = JSON.parse(storedData);
                    console.log('è¡Œç¨‹å·²å¾ LocalStorage è¼‰å…¥ã€‚');
                    // æª¢æŸ¥æ•¸æ“šçµæ§‹æ˜¯å¦ç›¸å®¹ï¼Œå¦‚æœä¸ç›¸å®¹å‰‡ä½¿ç”¨å‚™ä»½
                    if (!Array.isArray(currentItineraryData) || currentItineraryData.length !== originalItineraryData.length) {
                        currentItineraryData = JSON.parse(JSON.stringify(originalItineraryData));
                        console.log('LocalStorage è³‡æ–™çµæ§‹ç•°å¸¸ï¼Œå·²è¼‰å…¥åŸå§‹è³‡æ–™ã€‚');
                    }
                } else {
                    // å¦‚æœæ²’æœ‰å­˜å„²çš„æ•¸æ“šï¼Œå‰‡ä½¿ç”¨åŸå§‹æ•¸æ“š
                    currentItineraryData = JSON.parse(JSON.stringify(originalItineraryData));
                    console.log('è¼‰å…¥åŸå§‹è¡Œç¨‹è³‡æ–™ã€‚');
                }
            } catch (e) {
                console.error('LocalStorage è®€å–æˆ–è§£æéŒ¯èª¤ï¼Œä½¿ç”¨åŸå§‹è³‡æ–™:', e);
                currentItineraryData = JSON.parse(JSON.stringify(originalItineraryData));
            }
        }

        function saveItineraryData() {
            try {
                localStorage.setItem('user_itinerary_hiroshima', JSON.stringify(currentItineraryData));
                console.log('è¡Œç¨‹ä¿®æ”¹å·²å­˜å…¥ LocalStorageã€‚');
            } catch (e) {
                console.error('LocalStorage å¯«å…¥éŒ¯èª¤:', e);
            }
        }

        // --- æ¨¡æ…‹è¦–çª—é€šç”¨åŠŸèƒ½ ---
        window.closeModal = function(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('is-open');
                setTimeout(() => {
                    modal.classList.add('hidden');
                    document.body.style.overflow = '';
                }, 300);
            }
        };

        // --- ç·¨è¼¯åŠŸèƒ½ (é•·æŒ‰/å³éµè§¸ç™¼) ---
        function findEventByUniqueId(uniqueId) {
            for (let d = 0; d < currentItineraryData.length; d++) {
                const day = currentItineraryData[d];
                for (let e = 0; e < day.events.length; e++) {
                    const event = day.events[e];
                    if (event.uniqueId === uniqueId) {
                        return { dayIndex: d, eventIndex: e, event: event, isItem: false };
                    }
                    if (event.items) {
                        for (let i = 0; i < event.items.length; i++) {
                            const item = event.items[i];
                            if (item.uniqueId === uniqueId) {
                                return { dayIndex: d, eventIndex: e, itemIndex: i, item: item, isItem: true };
                            }
                        }
                    }
                }
            }
            return null;
        }

        window.showEditModal = function(uniqueId, event) {
            event.preventDefault();
            event.stopPropagation();
            const found = findEventByUniqueId(uniqueId);
            if (!found) return;

            const data = found.isItem ? found.item : found.event;
            const descField = found.isItem ? data.details : data.desc;
            const timeField = found.isItem ? (found.event.time || '') : (data.time || '');

            document.getElementById('edit-day-index').value = found.dayIndex;
            document.getElementById('edit-event-index').value = found.eventIndex;
            document.getElementById('edit-item-index').value = found.isItem ? found.itemIndex : -1;
            document.getElementById('edit-time').value = timeField;
            document.getElementById('edit-title').value = data.title || data.name;
            document.getElementById('edit-desc').value = descField || '';

            const timeInput = document.getElementById('edit-time');
            if (found.isItem) {
                timeInput.disabled = true;
                timeInput.classList.add('bg-gray-100', 'cursor-not-allowed');
                timeInput.placeholder = 'æ™¯é»å­é …ç›®ä¸ç·¨è¼¯æ™‚é–“';
            } else {
                timeInput.disabled = false;
                timeInput.classList.remove('bg-gray-100', 'cursor-not-allowed');
            }

            const modal = document.getElementById('edit-modal');
            modal.classList.remove('hidden');
            requestAnimationFrame(() => {
                modal.classList.add('is-open');
                document.body.style.overflow = 'hidden';
            });
        };

        window.saveEdit = function(e) {
            e.preventDefault();
            const dayIndex = parseInt(document.getElementById('edit-day-index').value);
            const eventIndex = parseInt(document.getElementById('edit-event-index').value);
            const itemIndex = parseInt(document.getElementById('edit-item-index').value);
            const newTime = document.getElementById('edit-time').value.trim();
            const newTitle = document.getElementById('edit-title').value.trim();
            const newDesc = document.getElementById('edit-desc').value.trim();

            if (dayIndex >= 0 && eventIndex >= 0) {
                let target;
                if (itemIndex >= 0) {
                    target = currentItineraryData[dayIndex].events[eventIndex].items[itemIndex];
                    target.name = newTitle;
                    target.details = newDesc;
                } else {
                    target = currentItineraryData[dayIndex].events[eventIndex];
                    target.time = newTime;
                    target.title = newTitle;
                    target.desc = newDesc;
                }
                saveItineraryData();
                renderItinerary(currentDayIndex);
                closeModal('edit-modal');
            }
        };

        // --- è¡Œç¨‹æ¸²æŸ“èˆ‡äº‹ä»¶ç¶å®š ---
        window.switchMainTab = function(tabId) {
            document.querySelectorAll('.tab-view').forEach(el => el.classList.add('hidden'));
            document.getElementById(`view-${tabId}`).classList.remove('hidden');
            
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            const navMap = { 'itinerary': 0, 'info': 1, 'prep': 2, 'guide': 3 };
            document.querySelectorAll('.nav-btn')[navMap[tabId]].classList.add('active');
            
            if (tabId === 'itinerary') {
                renderItinerary(currentDayIndex);
            } else {
                window.scrollTo(0,0);
            }
        };

        window.openMap = function(query) {
            window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(query)}`, '_blank');
        };

        window.showDetailsModal = function(encodedDetails, title) {
            try {
                const details = decodeURIComponent(escape(atob(encodedDetails)));
                let formattedDetails = details.replace(/\n/g, '<br>');
                document.getElementById('modal-title').textContent = title;
                document.getElementById('modal-body').innerHTML = formattedDetails;
                
                const modal = document.getElementById('details-modal');
                modal.classList.remove('hidden');
                requestAnimationFrame(() => {
                    modal.classList.add('is-open');
                    document.body.style.overflow = 'hidden';
                });
            } catch (e) {
                console.error("Error decoding modal content:", e);
            }
        };

        function renderItinerary(dayIndex) {
            currentDayIndex = dayIndex;
            const container = document.getElementById('day-content-container');
            const data = currentItineraryData[dayIndex];

            // Render Tabs
            const tabContainer = document.getElementById('day-tabs-container');
            tabContainer.innerHTML = currentItineraryData.map((d, idx) => `
                <button onclick="renderItinerary(${idx})" 
                    class="day-tab-btn flex-1 aspect-[1/0.9] rounded-xl flex flex-col items-center justify-center shadow-sm ${idx === dayIndex ? 'active' : 'inactive'}">
                    <span class="text-xs font-medium mb-1 opacity-80">${d.date}</span>
                    <span class="text-xl font-bold tracking-tight">${d.dayLabel}</span>
                </button>
            `).join('');

            // Render Events
            let html = `<div class="mb-5 text-sm font-medium text-gray-500 pl-2 flex items-center"><span class="mr-1">ğŸ“</span> ${data.location}</div>`;
            
            html += data.events.map((event) => {
                let dotColor = 'bg-gray-300';
                if (event.type === 'transport') { dotColor = 'bg-blue-400'; }
                else if (event.type === 'meal') { dotColor = 'bg-orange-400'; }
                else if (event.type === 'spot') { dotColor = 'bg-red-500'; }
                else if (event.type === 'hotel') { dotColor = 'bg-indigo-400'; }

                let contentWrapperHtml = '';
                
                if (event.type === 'spot' && event.items) {
                    // æ™¯é»ç¾¤çµ„
                    contentWrapperHtml = `
                        <div class="mb-2 text-xs font-mono font-bold text-gray-500 bg-gray-100 inline-block px-2 py-0.5 rounded">${event.time}</div>
                        <div class="space-y-4">
                            ${event.items.map((item) => {
                                const encodedDetails = btoa(unescape(encodeURIComponent(item.details)));
                                const logisticsHtml = item.logistics ? `<div class="logistics-list">${item.logistics}</div>` : '';
                                return `
                                    <div class="bg-white rounded-xl p-4 flat-card border border-gray-100 shadow-sm relative overflow-hidden editable-card"
                                        oncontextmenu="showEditModal('${item.uniqueId}', event)"
                                        ontouchstart="handleTouchStart(event, '${item.uniqueId}')"
                                        ontouchend="handleTouchEnd()"
                                        onmousedown="handleMouseDown(event, '${item.uniqueId}')"
                                        onmouseup="handleMouseUp()"
                                    >
                                        <div class="relative z-10">
                                            <div class="font-bold text-gray-800 text-lg mb-2 flex justify-between items-start">
                                                ${item.name}
                                                <button onclick="openMap('${item.mapQuery || item.name}')" class="text-gray-400 hover:text-blue-500 p-1.5 rounded-full transition">
                                                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path></svg>
                                                </button>
                                            </div>
                                            ${logisticsHtml}
                                            <button onclick="showDetailsModal('${encodedDetails}', '${item.name}')" class="mt-3 text-blue-600 bg-blue-50 hover:bg-blue-100 px-3 py-1.5 rounded-full text-xs font-bold transition flex items-center">
                                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"></path></svg>
                                                è©³ç´°ä»‹ç´¹
                                            </button>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    `;
                } else {
                    // ä¸€èˆ¬äº‹ä»¶
                    const descHtml = event.desc ? `<div class="logistics-list">${event.desc}</div>` : '';
                    contentWrapperHtml = `
                        <div class="flat-card p-4 relative bg-white editable-card"
                            oncontextmenu="showEditModal('${event.uniqueId}', event)"
                            ontouchstart="handleTouchStart(event, '${event.uniqueId}')"
                            ontouchend="handleTouchEnd()"
                            onmousedown="handleMouseDown(event, '${event.uniqueId}')"
                            onmouseup="handleMouseUp()"
                        >
                            <div class="text-xs font-mono font-bold text-gray-500 mb-1">${event.time}</div>
                            <div class="font-bold text-gray-800 text-base">${event.title}</div>
                            ${descHtml}
                        </div>
                    `;
                }

                return `
                    <div class="timeline-item relative pl-6 pb-8 last:pb-0">
                        <div class="timeline-line"></div>
                        <div class="absolute left-[2px] top-[28px] w-2.5 h-2.5 rounded-full ${dotColor} border-2 border-white box-content z-10 shadow-sm"></div>
                        <div class="pl-6">${contentWrapperHtml}</div>
                    </div>
                `;
            }).join('');
            container.innerHTML = html;
        }

        window.renderItinerary = renderItinerary;

        // --- è§¸æ‘¸/æ»‘é¼ äº‹ä»¶è™•ç† (ç”¨æ–¼å¯¦ç¾é•·æŒ‰/å³éµç·¨è¼¯) ---
        let touchTimer = null;
        let isMoving = false;

        window.handleTouchStart = function(event, uniqueId) {
            if (event.touches.length > 1) return;
            isMoving = false;
            touchTimer = setTimeout(() => {
                if (!isMoving) { showEditModal(uniqueId, event); }
            }, 800);
            event.currentTarget.addEventListener('touchmove', handleTouchMove);
        };

        function handleTouchMove(event) {
            if (Math.abs(event.touches[0].clientX - event.currentTarget.getBoundingClientRect().left) > 10 ||
                Math.abs(event.touches[0].clientY - event.currentTarget.getBoundingClientRect().top) > 10) {
                isMoving = true;
            }
            clearTimeout(touchTimer);
        }

        window.handleTouchEnd = function() {
            clearTimeout(touchTimer);
            document.querySelectorAll('.editable-card').forEach(card => card.removeEventListener('touchmove', handleTouchMove));
        };

        window.handleMouseDown = function(event, uniqueId) {
            if (event.button === 0) { // å·¦éµé•·æŒ‰æ¨¡æ“¬
                isMoving = false;
                touchTimer = setTimeout(() => {
                    if (!isMoving) showEditModal(uniqueId, event);
                }, 800);
            }
        };

        window.handleMouseUp = function() { clearTimeout(touchTimer); };

        // --- åˆå§‹åŒ– ---
        window.onload = function() {
            loadItineraryData();
            renderItinerary(0);
        };
    </script>
</body>
</html>

